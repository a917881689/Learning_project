package com.yosakura.web.servlet;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class ShopServlet extends HttpServlet{
	private static final long serialVersionUID = 1L;
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// 1.获取请求中的商品id
		String[] pids = req.getParameterValues("product");
		// 2.从Cookie中获取以前购物车中的pid
		Cookie[] cookies = req.getCookies();
		String old_pid = null;
		StringBuilder sb = new StringBuilder();
		
		if (cookies != null) {
			for (Cookie cookie : cookies) {
				if ("pid".equals(cookie)) {
					old_pid = cookie.getValue();
				}
			}
		}
		if (old_pid != null) {
			
		}
		
		if (pids != null) {
			for (String pid : pids) {
				sb.append(pid).append("-");
			}
			String newPid = sb.substring(0,sb.length()-1);
			// 将拼接好的pid放到Cookie中发送到浏览器保存
			Cookie cookie = new Cookie("pid", newPid);
			resp.addCookie(cookie);
			resp.getWriter().write("<script type='text/javascript'>alert('hahaha')</script>");
			resp.setHeader("refresh", "1;url:index.html");
		}
		
	}
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		this.doGet(req, resp);
	}
}
